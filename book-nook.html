  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dragonfly Inn - BookNook </title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="icon" href="./assets/images/icon_updated-removebg-preview.png">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Playfair+Display&display=swap" rel="stylesheet" />
    <style>
      @font-face {
        font-family: "MyFont";
        src: url("../assets/fonts/frenchcroissantdemo-eaven.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
      }
      .myfont {
      font-family: "MyFont", sans-serif;
      }

      </style>
    <style>
      @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  /* base float */
  .cup {
    
    filter: drop-shadow(0 0 0 transparent);
  }

  /* hover: scale + glow while float continues */
  .cup:hover {
    scale: 1.15; /* modern shorthand */
    filter: drop-shadow(0 0 16px rgba(255, 255, 255, 0.8));
  }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Playfair Display"', 'serif'],
              title: ['"DM Serif Display"', 'serif'],
            },
            boxShadow: {
              'dream': '0 4px 20px rgba(0, 0, 0, 0.25)',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: 0, transform: 'translateY(20px)' },
                '100%': { opacity: 1, transform: 'translateY(0)' },
              },
              float: {
                '0%, 100%': { transform: 'translateY(0)' },
                '50%': { transform: 'translateY(-8px)' },
              },
              glow: {
                '0%, 100%': { opacity: 0.3 },
                '50%': { opacity: 0.7 },
              }
            },
            animation: {
              fadeIn: 'fadeIn 1s ease-in-out',
              float: 'float 3s ease-in-out infinite',
              glow: 'glow 2s ease-in-out infinite',
            },
          }
        }
      }
    </script>
  </head>

  <body class="min-h-screen bg-[url('./assets/images/Untitled_design.png')] bg-cover bg-fixed bg-center text-gray-800 flex flex-col items-center py-12 px-4">
    <img src="./assets/images/cup_crop.png" 
      alt="Cup"
      id="cup"
      class="cup w-24 h-24 fixed right-12 top-12 z-10 transform transition-all duration-500 hover:animate-float cursor-pointer" />

      <!-- Audio element -->
      <audio id="chime-sound" src="./assets/images/sounds/Wind Chimes.mp3" preload="auto"></audio>
   
      <audio id="bgMusic" src="./assets/audios/honey_tea_lemon.mp3" loop></audio>
    <main class="flex justify-center w-full h-full animate-fadeIn relative">

      <!-- Floating background icons -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-10 left-12 text-green-500 opacity-50 animate-float">üçÄ</div>
        <div class="absolute bottom-10 right-20 text-yellow-600 opacity-50 animate-glow">üìñ</div>
        <div class="absolute top-1/3 right-16 text-green-400 opacity-50 animate-float">üçÄ</div>
      </div>

      <!-- Main content box -->
      <div class="w-[55%] h-[80vh] rounded-3xl px-8 py-10 relative z-10 flex bg-transparent">

        <div class="flex justify-center gap-16">
          <!-- Sidebar -->
          <aside class="ml-14 mt-2 mb-12 rounded-l-2xl ">
            <nav class="text-left mt-16">
              <img src="./assets/images/tamannapfp-removebg-preview.png" alt="seal"
                class="w-44 h-32 object-cover mb-6 transition-transform duration-300 " />
              <ul class="space-y-6 text-lg  text-gray-700">
                <li><a href="index.html" class="hover:text-green-700 transition-colors">Home</a></li>
                <li><a href="get-working.html" class="hover:text-green-700 transition-colors">Workaholic</a></li>
                <li><a href="book-nook.html" class="text-green-700 font-semibold">Book nook</a></li>
                <li><a href="creator.html" class="hover:text-green-700 transition-colors">Creator</a></li>
                <li><a href="guest-book.html" class="hover:text-green-700 transition-colors">Guest book</a></li>
                <li><a href="cattos.html" class="hover:text-green-700 transition-colors">Cattos &lt;3</a></li>
              </ul>
            </nav>
          </aside>

          <!-- Main Section -->
          <section class="w-full h-full overflow-y-auto pl-6 pr-4 text-center font-serif scrollbar-hide">
            <style>
              section::-webkit-scrollbar { display: none; }
            </style>
            <div class="max-w-2xl mx-auto p-4 space-y-5">
              <!-- START: Book Nook - Dessert Pairing + Order + Centered Modal (with animation) -->
<style>
  /* Modal entrance animation (fade + slight zoom) */
  @keyframes modalIn {
    from { opacity: 0; transform: translateY(-6px) scale(0.985); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }
  .modal-open-anim {
    animation: modalIn 220ms cubic-bezier(.2,.8,.2,1);
  }

  /* Recommendation popup animation */
  @keyframes popIn {
    from { 
      opacity: 0; 
      transform: translateY(-20px) scale(0.95); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0) scale(1); 
    }
  }
  .rec-open-anim {
    animation: popIn 400ms cubic-bezier(.2,.8,.2,1);
  }

  /* Book card entrance animation */
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .book-card-anim {
    animation: slideInUp 500ms ease-out forwards;
  }
</style>

<div class=" max-w-2xl mx-auto p-4 space-y-5 text-[#6B4600]" id="book-nook-inner">
  <h2 class="myfont text-5xl text-center">The Book Nook</h2>
  <p class="text-center text-sm text-gray-600 mb-2">Tap a dessert to add it to your order. Tap again to remove.</p>

  <!-- Cards container (populated by script) -->
  <div id="menu-list" class="space-y-4"></div>

  <!-- Order summary + Checkout -->
  <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-4 shadow-lg">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="text-lg font-medium">Your Order</h3>
        <p class="text-xs text-gray-500">Selected items appear here. Tap a card again to remove.</p>
      </div>
      <button id="checkout-btn" class="bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700 disabled:opacity-60" disabled>
        Checkout
      </button>
    </div>

    <ul id="order-list" class="mt-3 space-y-2 text-sm" aria-live="polite">
      <li class="text-xs text-gray-500">No items selected yet.</li>
    </ul>

    <div id="order-total" class="mt-3 text-sm font-semibold">Total: ‚Äî</div>
  </div>
</div>

<!-- Centered Checkout Modal -->
<div id="checkout-modal" class="fixed inset-0 hidden z-50 flex items-center justify-center">
  <!-- background overlay (darker + blur to avoid bright band) -->
  <div id="modal-backdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

  <!-- modal box -->
  <div id="modal-box" class="relative bg-white rounded-2xl shadow-2xl max-w-xl w-[92%] sm:w-[80%] md:w-[60%] p-6 z-10 border border-gray-200">
    <h3 class="text-2xl font-serif mb-2">Your Order</h3>
    <div id="modal-content" class="space-y-4 max-h-[60vh] overflow-auto text-sm"></div>

    <div class="mt-4 flex gap-3 justify-end">
      <button id="modal-close" class="px-4 py-2 rounded border">Close</button>
      <button id="modal-confirm" class="px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700">Get Book Recommendations</button>
    </div>
  </div>
</div>

<!-- Book Recommendations Popup -->
<div id="recommendations-popup" class="fixed inset-0 hidden z-[60] flex items-center justify-center">
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="rec-backdrop"></div>
  
  <div id="rec-box" class="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-[95%] sm:w-[85%] md:w-[70%] p-8 z-10 border border-gray-200">
    <!-- Header with decorative elements -->
    <div class="text-center mb-6">
      <div class="text-4xl mb-2">üìö‚ú®</div>
      <h2 class="myfont text-4xl text-emerald-800 mb-2">Your Perfect Reads</h2>
      <p class="text-sm text-gray-600 italic">Curated just for your tastes</p>
    </div>

    <!-- Loading state -->
    <div id="rec-loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-emerald-200 border-t-emerald-600 mb-4"></div>
      <p class="text-gray-600">Finding the perfect books for you...</p>
    </div>

    <!-- Recommendations content -->
    <div id="rec-content" class="hidden space-y-4 max-h-[60vh] overflow-auto"></div>

    <!-- Close button -->
    <div class="mt-6 text-center">
      <button id="rec-close" class="px-6 py-3 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 transition-all shadow-md">
        Close & Enjoy Reading üçÄ
      </button>
    </div>
  </div>
</div>

<script>
(function(){
  // ========== MENU definition ==========
  const MENU = {
    "cheesecake": {
      title: "Blueberry Cheesecake",
      price: 150,
      mood: "Whimsical, lighthearted novels",
      books: [
        { title: "The Night Circus", author: "Erin Morgenstern" },
        { title: "The Rosie Project", author: "Graeme Simsion" },
        { title: "The Little Prince", author: "Antoine de Saint-Exup√©ry" }
      ],
      img: "./assets/images/cheesecake.png"
    },
    "black-coffee": {
      title: "Black Coffee",
      price: 60,
      mood: "Existential classics",
      books: [
        { title: "The Stranger", author: "Albert Camus" },
        { title: "Notes from Underground", author: "Fyodor Dostoevsky" },
        { title: "Nausea", author: "Jean-Paul Sartre" }
      ],
      img: "./assets/images/blackcoffee.jpg"
    },
    "hot-chocolate": {
      title: "Hot Chocolate",
      price: 70,
      mood: "Comfort reads & children's fiction",
      books: [
        { title: "The Wind in the Willows", author: "Kenneth Grahame" },
        { title: "The House at Pooh Corner", author: "A.A. Milne" },
        { title: "The Guernsey Literary and Potato Peel Pie Society", author: "Mary Ann Shaffer & Annie Barrows" }
      ],
      img: "./assets/images/hotchoco.jpg"
    },
    "brownie": {
      title: "Chocolate Brownie",
      price: 90,
      mood: "Intense page-turners",
      books: [
        { title: "Gone Girl", author: "Gillian Flynn" },
        { title: "The Girl with the Dragon Tattoo", author: "Stieg Larsson" },
        { title: "Sharp Objects", author: "Gillian Flynn" }
      ],
      img: "./assets/images/brownie.png"
    }
  };

  // ========== State ==========
  const order = new Set();

  // ========== Refs ==========
  const menuList = document.getElementById('menu-list');
  const orderListEl = document.getElementById('order-list');
  const orderTotalEl = document.getElementById('order-total');
  const checkoutBtn = document.getElementById('checkout-btn');

  const modal = document.getElementById('checkout-modal');
  const modalBox = document.getElementById('modal-box');
  const modalContent = document.getElementById('modal-content');
  const modalClose = document.getElementById('modal-close');
  const modalConfirm = document.getElementById('modal-confirm');
  const modalBackdrop = document.getElementById('modal-backdrop');

  // ======= Helpers =======
  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, function(m) {
      return ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m];
    });
  }

  // Format currency (digit-by-digit safety)
  function formatCurrency(n) {
    const s = String(Math.round(n)); // assume integer TL
    return s.replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " TL";
  }

  // ======= Render menu cards =======
  function renderMenu() {
    menuList.innerHTML = '';
    Object.keys(MENU).forEach(key => {
      const item = MENU[key];

      const card = document.createElement('div');
      card.className = 'bg-white/70 backdrop-blur-sm rounded-2xl shadow-lg overflow-hidden relative';

      // header (selectable)
      const header = document.createElement('button');
      header.className = 'w-full flex items-center gap-4 p-4 text-left focus:outline-none';
      header.setAttribute('aria-pressed', 'false');
      header.setAttribute('data-key', key);

      header.innerHTML = `
        <img src="${escapeHtml(item.img)}" alt="${escapeHtml(item.title)}" class="w-20 h-20 object-cover rounded-xl shadow flex-shrink-0">
        <div class="flex-1">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h3 class="text-lg font-semibold">${escapeHtml(item.title)}</h3>
              <p class="text-xs italic text-gray-600">${escapeHtml(item.mood)}</p>
            </div>
            <div class="text-sm font-medium">${formatCurrency(item.price)}</div>
          </div>
        </div>
      `;

      // assemble
      card.appendChild(header);
      menuList.appendChild(card);

      // ===== events =====
      header.addEventListener('click', () => {
        const key = header.getAttribute('data-key');
        if (order.has(key)) {
          order.delete(key);
          header.classList.remove('ring-2', 'ring-emerald-400', 'bg-emerald-50');
          header.setAttribute('aria-pressed', 'false');
        } else {
          order.add(key);
          header.classList.add('ring-2', 'ring-emerald-400', 'bg-emerald-50');
          header.setAttribute('aria-pressed', 'true');
        }
        updateOrderUI();
      });
    });
  }

  // ====== Update Order UI ======
  function updateOrderUI() {
    orderListEl.innerHTML = '';
    if (order.size === 0) {
      orderListEl.innerHTML = '<li class="text-xs text-gray-500">No items selected yet.</li>';
      orderTotalEl.textContent = 'Total: ‚Äî';
      checkoutBtn.disabled = true;
      return;
    }

    let subtotal = 0;
    order.forEach(key => {
      const item = MENU[key];
      subtotal += Number(item.price);
      const li = document.createElement('li');
      li.className = 'flex items-center justify-between';
      li.innerHTML = `<span>${escapeHtml(item.title)}</span><span class="text-sm font-medium">${formatCurrency(item.price)}</span>`;
      orderListEl.appendChild(li);
    });

    orderTotalEl.textContent = 'Total: ' + formatCurrency(subtotal);
    checkoutBtn.disabled = false;
  }

  // ===== Checkout Modal =====
  function openCheckoutModal() {
    modalContent.innerHTML = '';
    let subtotal = 0;

    order.forEach(key => {
      const item = MENU[key];
      subtotal += Number(item.price);

      const block = document.createElement('div');
      block.className = 'border rounded p-3';
      block.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="font-semibold">${escapeHtml(item.title)}</div>
            <div class="text-xs italic text-gray-600">${escapeHtml(item.mood)}</div>
          </div>
          <div class="text-sm font-medium">${formatCurrency(item.price)}</div>
        </div>
      `;
      modalContent.appendChild(block);
    });

    const totalsBlock = document.createElement('div');
    totalsBlock.className = 'mt-3 text-sm';
    totalsBlock.innerHTML = `<div class="font-semibold">Subtotal: ${formatCurrency(subtotal)}</div>`;
    modalContent.appendChild(totalsBlock);

    // show modal, add animation class
    modal.classList.remove('hidden');
    modalBox.classList.add('modal-open-anim');
    // small focus trap: focus first close button
    modalClose.focus();
    // prevent page scroll while modal open
    document.documentElement.style.overflow = 'hidden';
  }

  function closeModal() {
    // hide and reset animation class
    modalBox.classList.remove('modal-open-anim');
    modal.classList.add('hidden');
    document.documentElement.style.overflow = '';
  }

  async function confirmOrder() {
    // Close checkout modal
    closeModal();
    
    // Open recommendations popup with loading state
    const recPopup = document.getElementById('recommendations-popup');
    const recBox = document.getElementById('rec-box');
    const recLoading = document.getElementById('rec-loading');
    const recContent = document.getElementById('rec-content');
    
    recPopup.classList.remove('hidden');
    recBox.classList.add('rec-open-anim');
    recLoading.classList.remove('hidden');
    recContent.classList.add('hidden');
    document.documentElement.style.overflow = 'hidden';

    // Prepare order data for API
    const orderItems = [];
    order.forEach(key => {
      const item = MENU[key];
      orderItems.push({
        title: item.title,
        mood: item.mood
      });
    });

    try {
      const response = await fetch('http://localhost:3000/recommend-books-gemini', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ orderItems }),
      });

      const result = await response.json();

      if (result.success && result.recommendations) {
        // Hide loading, show recommendations
        recLoading.classList.add('hidden');
        recContent.classList.remove('hidden');
        
        // Display recommendations
        recContent.innerHTML = '';
        result.recommendations.forEach((book, index) => {
          const bookCard = document.createElement('div');
          bookCard.className = 'bg-white rounded-xl p-5 shadow-md border border-gray-200 book-card-anim';
          bookCard.style.animationDelay = `${index * 150}ms`;
          bookCard.style.opacity = '0';
          
          bookCard.innerHTML = `
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-2xl font-bold text-emerald-700">
                ${index + 1}
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-serif font-semibold text-gray-900 mb-1">${escapeHtml(book.title)}</h3>
                <p class="text-sm text-gray-600 mb-2">by ${escapeHtml(book.author)}</p>
                ${book.reason ? `<p class="text-sm text-gray-700 italic">"${escapeHtml(book.reason)}"</p>` : ''}
              </div>
            </div>
          `;
          recContent.appendChild(bookCard);
        });
      } else {
        // Error state
        recLoading.classList.add('hidden');
        recContent.classList.remove('hidden');
        recContent.innerHTML = `
          <div class="text-center py-8">
            <p class="text-gray-600 mb-4">Oops! We couldn't fetch recommendations right now.</p>
            <p class="text-sm text-gray-500">Please try again later or ask our staff for suggestions!</p>
          </div>
        `;
      }
    } catch (error) {
      console.error('Error fetching recommendations:', error);
      recLoading.classList.add('hidden');
      recContent.classList.remove('hidden');
      recContent.innerHTML = `
        <div class="text-center py-8">
          <p class="text-gray-600 mb-4">Couldn't connect to our recommendation service.</p>
          <p class="text-sm text-gray-500">Make sure the backend server is running!</p>
        </div>
      `;
    }
  }

  function closeRecommendationsPopup() {
    const recPopup = document.getElementById('recommendations-popup');
    const recBox = document.getElementById('rec-box');
    recBox.classList.remove('rec-open-anim');
    recPopup.classList.add('hidden');
    document.documentElement.style.overflow = '';
    
    // Clear order after viewing recommendations
    order.clear();
    renderMenu();
    updateOrderUI();
  }

  // init
  renderMenu();
  updateOrderUI();

  // events
  checkoutBtn.addEventListener('click', openCheckoutModal);
  modalClose.addEventListener('click', closeModal);
  modalBackdrop.addEventListener('click', closeModal);
  modalConfirm.addEventListener('click', confirmOrder);

  // Recommendation popup events
  document.getElementById('rec-close').addEventListener('click', closeRecommendationsPopup);
  document.getElementById('rec-backdrop').addEventListener('click', closeRecommendationsPopup);

  // keyboard escape to close modals
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (!document.getElementById('recommendations-popup').classList.contains('hidden')) {
        closeRecommendationsPopup();
      } else if (!modal.classList.contains('hidden')) {
        closeModal();
      }
    }
  });
})();
</script>
<!-- END: Book Nook - Dessert Pairing + Order + Centered Modal -->

          </section>
        </div>
      </div>
    </main>

    <script src="./js/script.js"></script>
    <script>
    const music = document.getElementById('bgMusic');
    const profileImage = document.getElementById('profileImage');
    let isPlaying = true;

    // Restore playback position + state when page loads
    window.addEventListener('load', () => {
      const lastTime = localStorage.getItem('musicTime');
      const isPaused = localStorage.getItem('musicPaused') === 'true';

      if (lastTime) {
        music.currentTime = parseFloat(lastTime);
      }

      const playPromise = music.play();
      if (playPromise !== undefined) {
        playPromise.catch(() => {
          console.warn("Autoplay might be blocked until user interacts.");
        });
      }

      if (isPaused) {
        music.pause();
        isPlaying = false;
      }
    });

    // Save current position + state before leaving page
    window.addEventListener('beforeunload', () => {
      localStorage.setItem('musicTime', music.currentTime);
      localStorage.setItem('musicPaused', music.paused);
    });

    // Toggle on click
    profileImage.addEventListener('click', () => {
      if (isPlaying) {
        music.pause();
        profileImage.classList.remove('playing');
      } else {
        music.play();
        profileImage.classList.add('playing');
      }
      isPlaying = !isPlaying;
    });
  </script>
  </body>
  <script>
      document.addEventListener("DOMContentLoaded", () => {
        const cup = document.getElementById('cup');
        const chime = document.getElementById('chime-sound');

        // Allow browser to unlock audio playback
        document.body.addEventListener('click', () => {
          chime.play();
          chime.pause();
        }, { once: true });

        // Play sound when mouse enters
        cup.addEventListener('mouseenter', () => {
          chime.currentTime = 0;
          chime.play();
        });

        // Stop sound when mouse leaves
        cup.addEventListener('mouseleave', () => {
          chime.pause();
          chime.currentTime = 0; // rewind to start
        });
      });
    </script>
  </html>
